<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PToken DApp</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="mobile-container">
    <!-- هدر -->
    <header class="mobile-header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="logo-text">
            <h1>PToken</h1>
            <span class="logo-subtitle">Polygon Network</span>
          </div>
        </div>
        <div class="network-status">
          <div class="status-indicator">
            <div class="pulse-dot"></div>
            <span>آنلاین</span>
          </div>
        </div>
      </div>
    </header>

    <!-- محتوای اصلی -->
    <main class="mobile-main">
      <!-- تب کیف پول -->
      <div id="wallet-tab" class="tab-content active">
        <div class="mobile-section">
          <div class="hero-section">
            <div class="hero-icon">
              <div class="floating-wallet">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="floating-coin coin-1">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-2">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-3">
                <i class="fas fa-circle"></i>
              </div>
            </div>
            <h2 class="hero-title">خوش آمدید</h2>
            <p class="hero-subtitle">برای شروع، کیف پول خود را متصل کنید</p>
          </div>

          <div class="action-card">
            <button id="connect-btn" onclick="connectWallet()" class="btn-connect animated-btn">
              <div class="btn-content">
                <i class="fas fa-plug"></i>
                <span>اتصال به MetaMask</span>
              </div>
              <div class="btn-glow"></div>
            </button>

            <button id="disconnect-btn" onclick="disconnectWallet()" class="btn-disconnect" style="display: none;">
              <i class="fas fa-power-off"></i>
              قطع اتصال
            </button>
          </div>

          <div id="account" class="account-display" style="display: none;">
            <div class="account-card">
              <div class="account-header">
                <i class="fas fa-check-circle"></i>
                <span>اتصال موفق</span>
              </div>
              <div class="account-address"></div>
              <div class="account-balance">
                <span class="balance-label">موجودی:</span>
                <span class="balance-value" id="wallet-balance">0 MATIC</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب پروفایل کاربری -->
      <div id="user-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>پروفایل کاربری</h2>
            <div class="user-badge" id="user-status-badge">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <!-- بخش ثبت‌نام برای کاربران جدید -->
          <div id="registration-section" class="registration-card" style="display: none;">
            <div class="card-header">
              <h3>ثبت‌نام جدید</h3>
              <div class="price-tag">350 MATIC</div>
            </div>
            
            <div class="form-group">
              <label class="input-label">
                <i class="fas fa-user-friends"></i>
                شناسه کاربر آپلاین
              </label>
              <input id="upline-address" type="number" placeholder="مثال: 1234" class="modern-input">
            </div>

            <div class="position-selector">
              <div class="selector-title">موقعیت قرارگیری</div>
              <div class="position-options">
                <label class="position-card">
                  <input type="radio" name="place" value="left" checked>
                  <div class="card-content">
                    <div class="position-icon left">
                      <i class="fas fa-arrow-left"></i>
                    </div>
                    <span>سمت چپ</span>
                  </div>
                </label>
                <label class="position-card">
                  <input type="radio" name="place" value="right">
                  <div class="card-content">
                    <div class="position-icon right">
                      <i class="fas fa-arrow-right"></i>
                    </div>
                    <span>سمت راست</span>
                  </div>
                </label>
              </div>
            </div>

            <button onclick="register()" class="btn-register animated-btn">
              <i class="fas fa-user-plus"></i>
              تکمیل ثبت‌نام
            </button>
          </div>

          <!-- اطلاعات کاربر ثبت‌نام کرده -->
          <div id="user-profile" class="user-profile" style="display: none;">
            <div class="profile-header">
              <div class="profile-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="profile-info">
                <h3>کاربر شماره <span id="profile-user-id">-</span></h3>
                <p>آپلاین: <span id="profile-upline-id">-</span></p>
              </div>
            </div>

            <div class="network-stats">
              <div class="network-stat">
                <div class="stat-icon left">
                  <i class="fas fa-arrow-left"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="left-count">0</div>
                  <div class="stat-label">سمت چپ</div>
                </div>
              </div>

              <div class="network-stat">
                <div class="stat-icon right">
                  <i class="fas fa-arrow-right"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="right-count">0</div>
                  <div class="stat-label">سمت راست</div>
                </div>
              </div>

              <div class="network-stat">
                <div class="stat-icon total">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="total-count">0</div>
                  <div class="stat-label">کل زیرمجموعه</div>
                </div>
              </div>
            </div>

            <div class="balance-stats">
              <div class="balance-card">
                <div class="balance-header">
                  <i class="fas fa-chart-line"></i>
                  <span>تعادل خورده</span>
                </div>
                <div class="balance-value" id="balance-count">0</div>
              </div>

              <div class="balance-card">
                <div class="balance-header">
                  <i class="fas fa-piggy-bank"></i>
                  <span>تعادل ذخیره</span>
                </div>
                <div class="balance-value" id="saved-balance-count">0</div>
              </div>
            </div>
          </div>

          <!-- آمار کلی -->
          <div class="stats-container">
            <div class="stats-grid">
              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-id-card"></i>
                  </div>
                  <span class="stat-label">شناسه شما</span>
                </div>
                <div class="stat-value" id="user-id">-</div>
              </div>

              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-user-tag"></i>
                  </div>
                  <span class="stat-label">آپلاین</span>
                </div>
                <div class="stat-value" id="user-upline">-</div>
              </div>

              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-coins"></i>
                  </div>
                  <span class="stat-label">پاداش ماینر</span>
                </div>
                <div class="stat-value" id="miner-rewards-profile">0</div>
              </div>

              <div class="stat-item fade-in">
                <div class="stat-header">
                  <div class="stat-icon">
                    <i class="fas fa-gem"></i>
                  </div>
                  <span class="stat-label">وضعیت ماینر</span>
                </div>
                <div class="stat-value" id="miner-status-profile">غیرفعال</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب ساختار درختی -->
      <div id="tree-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>شبکه درختی</h2>
            <div class="tree-controls">
              <button onclick="displayTree()" class="btn-refresh">
                <i class="fas fa-sync-alt"></i>
              </button>
              <div class="level-selector">
                <span>سطح: </span>
                <select id="tree-level" onchange="displayTree()">
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
              </div>
            </div>
          </div>

          <div class="tree-wrapper">
            <div class="tree-info">
              <div class="tree-stats">
                <div class="tree-stat">
                  <span>کل اعضا:</span>
                  <strong id="total-members">0</strong>
                </div>
                <div class="tree-stat">
                  <span>نمایش تا سطح:</span>
                  <strong id="current-level">3</strong>
                </div>
              </div>
            </div>

            <div class="tree-container">
              <div id="tree" class="binary-tree">
                <div class="tree-placeholder">
                  <div class="placeholder-icon">
                    <i class="fas fa-sitemap"></i>
                  </div>
                  <p>شبکه شما خالی است</p>
                  <span>پس از ثبت‌نام، ساختار درختی شما اینجا نمایش داده می‌شود</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب ماینر -->
      <div id="miner-tab" class="tab-content">
        <div class="mobile-section">
          <div class="miner-header">
            <h2>سیستم ماینر</h2>
            <div class="miner-status-badge" id="miner-global-status">
              <div class="status-indicator"></div>
              <span>در حال بررسی...</span>
            </div>
          </div>

          <!-- انیمیشن ماینر -->
          <div class="miner-animation-container">
            <div class="miner-animation" id="miner-animation">
              <div class="miner-character">
                <div class="miner-body">
                  <div class="miner-head"></div>
                  <div class="miner-torso"></div>
                  <div class="miner-arm left"></div>
                  <div class="miner-arm right"></div>
                </div>
                <div class="miner-pickaxe"></div>
              </div>
              <div class="miner-ground"></div>
              <div class="miner-sparks"></div>
            </div>
          </div>

          <div class="miner-dashboard">
            <div class="miner-cards">
              <div class="miner-card primary">
                <div class="miner-card-content">
                  <div class="miner-icon">
                    <i class="fas fa-hard-hat"></i>
                  </div>
                  <div class="miner-info">
                    <div class="miner-label">وضعیت ماینر</div>
                    <div class="miner-value" id="miner-status">غیرفعال</div>
                  </div>
                </div>
              </div>

              <div class="miner-card success">
                <div class="miner-card-content">
                  <div class="miner-icon">
                    <i class="fas fa-coins"></i>
                  </div>
                  <div class="miner-info">
                    <div class="miner-label">توکن دریافتی</div>
                    <div class="miner-value" id="miner-rewards">0 PToken</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="miner-stats-grid">
              <div class="miner-stat-item">
                <div class="stat-icon">
                  <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">موجودی MATIC</div>
                  <div class="stat-value" id="matic-balance">0</div>
                </div>
              </div>

              <div class="miner-stat-item">
                <div class="stat-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">توکن موجود</div>
                  <div class="stat-value" id="available-tokens">0</div>
                </div>
              </div>

              <div class="miner-stat-item">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">ماینرهای فعال</div>
                  <div class="stat-value" id="active-miners">0</div>
                </div>
              </div>

              <div class="miner-stat-item">
                <div class="stat-icon">
                  <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">توزیع بعدی</div>
                  <div class="stat-value" id="next-distribution">-</div>
                </div>
              </div>
            </div>

            <div class="conversion-section">
              <div class="conversion-header">
                <h4>تبدیل MATIC به توکن</h4>
                <div class="conversion-rate">1 MATIC = 10 PToken</div>
              </div>
              <div class="conversion-inputs">
                <div class="input-group">
                  <input type="number" id="matic-amount" placeholder="مقدار MATIC" class="modern-input">
                  <button onclick="convertMaticToToken()" class="btn-convert">
                    <i class="fas fa-exchange-alt"></i>
                    تبدیل
                  </button>
                </div>
              </div>
            </div>

            <div class="miner-actions">
              <button onclick="contributeToMiner()" class="btn-miner-action primary">
                <i class="fas fa-donate"></i>
                خرید توکن ماینر
              </button>
              <button onclick="distributeMinerTokens()" class="btn-miner-action secondary">
                <i class="fas fa-share-alt"></i>
                دریافت پاداش
              </button>
              <button onclick="donateToMinerPool()" class="btn-miner-action success">
                <i class="fas fa-gift"></i>
                اهدای MATIC
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- تب برداشت -->
      <div id="withdraw-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>دریافت سود</h2>
            <div class="earnings-badge">
              <i class="fas fa-money-bill-wave"></i>
            </div>
          </div>

          <!-- استخر ویژه -->
          <div class="withdraw-card special">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-gem"></i>
              </div>
              <div class="card-title">
                <h3>استخر ویژه</h3>
                <p>تقسیم بین کاربران ویژه</p>
              </div>
            </div>
            <div class="card-content">
              <div class="amount-section">
                <div class="amount-display">
                  <span class="amount" id="special-balance">0</span>
                  <span class="currency">MATIC</span>
                </div>
                <div class="distribution-info">
                  <div class="info-item">
                    <i class="fas fa-users"></i>
                    <span>تعداد گیرندگان: <strong id="special-receivers">0</strong></span>
                  </div>
                  <div class="info-item">
                    <i class="fas fa-user-check"></i>
                    <span>سهم شما: <strong id="special-share">0</strong> MATIC</span>
                  </div>
                </div>
              </div>
              <div class="countdown-section">
                <div class="countdown-label">زمان باقی‌مانده تا برداشت:</div>
                <div class="countdown-timer" id="special-countdown">--:--:--</div>
              </div>
              <button onclick="withdrawSpecials()" class="btn-withdraw" id="special-withdraw-btn" disabled>
                <i class="fas fa-download"></i>
                برداشت ویژه
              </button>
            </div>
          </div>

          <!-- استخر پاداش -->
          <div class="withdraw-card reward">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="card-title">
                <h3>استخر پاداش</h3>
                <p>برداشت سود روزانه</p>
              </div>
            </div>
            <div class="card-content">
              <div class="amount-section">
                <div class="amount-display">
                  <span class="amount" id="pool-balance">0</span>
                  <span class="currency">MATIC</span>
                </div>
                <div class="pool-stats">
                  <div class="stat-row">
                    <span>تعادل خورده:</span>
                    <strong id="pool-consumed">0</strong>
                  </div>
                  <div class="stat-row">
                    <span>موجودی کل:</span>
                    <strong id="pool-total">0</strong>
                  </div>
                </div>
              </div>
              <div class="countdown-section">
                <div class="countdown-label">زمان برداشت بعدی:</div>
                <div class="countdown-timer" id="pool-countdown">--:--:--</div>
              </div>
              <button onclick="withdrawPool()" class="btn-withdraw" id="pool-withdraw-btn" disabled>
                <i class="fas fa-download"></i>
                برداشت از استخر
              </button>
            </div>
          </div>

          <!-- آمار برداشت -->
          <div class="earnings-stats">
            <div class="earnings-stat">
              <div class="stat-icon">
                <i class="fas fa-chart-bar"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">کل برداشت‌ها</div>
                <div class="stat-value" id="total-withdrawals">0 MATIC</div>
              </div>
            </div>
            <div class="earnings-stat">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">آخرین برداشت</div>
                <div class="stat-value" id="last-withdrawal">-</div>
              </div>
            </div>
            <div class="earnings-stat">
              <div class="stat-icon">
                <i class="fas fa-calendar"></i>
              </div>
              <div class="stat-content">
                <div class="stat-label">برداشت بعدی</div>
                <div class="stat-value" id="next-withdrawal">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ناوبری پایین -->
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="switchTab('wallet')">
        <div class="nav-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <span class="nav-label">کیف پول</span>
      </div>
      <div class="nav-item" onclick="switchTab('user')">
        <div class="nav-icon">
          <i class="fas fa-user"></i>
        </div>
        <span class="nav-label">پروفایل</span>
      </div>
      <div class="nav-item" onclick="switchTab('tree')">
        <div class="nav-icon">
          <i class="fas fa-sitemap"></i>
        </div>
        <span class="nav-label">شبکه</span>
      </div>
      <div class="nav-item" onclick="switchTab('miner')">
        <div class="nav-icon">
          <i class="fas fa-hard-hat"></i>
        </div>
        <span class="nav-label">ماینر</span>
      </div>
      <div class="nav-item" onclick="switchTab('withdraw')">
        <div class="nav-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <span class="nav-label">برداشت</span>
      </div>
    </nav>
  </div>

  <div id="message" class="message-toast"></div>

  <script src="app.js"></script>
</body>
</html>